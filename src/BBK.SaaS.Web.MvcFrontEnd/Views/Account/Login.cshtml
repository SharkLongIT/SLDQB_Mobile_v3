@using System.Globalization
@using Abp.Extensions
@using Abp.MultiTenancy
@using BBK.SaaS.Identity
@using BBK.SaaS.Localization
@using BBK.SaaS.Web.Security.Recaptcha
@using Owl.reCAPTCHA
@addTagHelper *, Owl.reCAPTCHA
@model BBK.SaaS.Web.Models.Account.LoginFormViewModel
@inject SignInManager SignInManager

@section Scripts
{
	@if (ViewBag.UseCaptcha)
	{
		<recaptcha-script-v3 />
		<recaptcha-script-v3-js action="login" execute="false" />
	}
	<script abp-src="/view-resources/Views/Account/Login.js" asp-append-version="true"></script>
}

@if (!Model.SuccessMessage.IsNullOrEmpty())
{
	<div class="alert alert-success alert-dismissible fade show" role="alert">
		@Model.SuccessMessage
		<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
	</div>
}

<div class="card-body p-0">
	<form class="mb-0 login-form form" asp-action="Login" method="post">
				<input type="hidden" name="returnUrl" value="@ViewBag.ReturnUrl" />
		<input type="hidden" name="returnUrlHash" />
		<input type="hidden" name="ss" value="@ViewBag.SingleSignIn" />
		@if (ViewBag.UseCaptcha)
		{
			<input type="hidden" name="@RecaptchaValidator.RecaptchaResponseKey" id="recaptchaResponse" />
		}
				<div class="fancy-title title-border title-center mb-4">
					<h1 class="fs-5 fw-semibold">Đăng nhập</h1>
				</div>

				<div class="row">
					<div class="col-12 form-group mb-4">
				<label for="login-form-username">@(new FixedLocalizableString("Số điện thoại hoặc email"))</label>
				<input class="form-control not-dark" type="text" placeholder="@(new FixedLocalizableString("Số điện thoại hoặc email"))" name="usernameOrEmailAddress" autocomplete="new-password" value="@(Model.UserNameOrEmailAddress ?? "")" required>
					
					</div>

					<div class="col-12 form-group mb-4">
						<div class="d-flex justify-content-between">
							<label for="login-form-password">@L("Password")</label>
							<a href="@Url.Action("ForgotPassword", "Account")" id="forget-password" class="fw-semibold text-smaller">@L("ForgotPassword")</a>
						</div>
						<input class="form-control not-dark" type="password" placeholder="@L("Password")" name="password" autocomplete="new-password">
				<div class="show-hide"><span class="show">                         </span></div>
					</div>

					<div class="col-12 form-group mb-0">
						<button class="btn btn-lg text-white bg-black h-bg-color d-block w-100 m-0" type="button" id="kt_login_signin_submit">@(new FixedLocalizableString("Đăng nhập"))</button>
					</div>
				</div>
			</form>


				@{
		var loginProviders = (await SignInManager.GetExternalAuthenticationSchemesAsync())
		.Where(s => !s.DisplayName.IsNullOrWhiteSpace())
		.ToList();

		Func<string, string> getSocialIconClass = (provider) =>
		{
			provider = provider.ToLower(CultureInfo.InvariantCulture);
			return provider;
		};
	}
	@if ((AbpSession.MultiTenancySide != MultiTenancySides.Host || !ViewBag.IsMultiTenancyEnabled) && loginProviders.Count > 0)
	{
		<!--begin::Divider-->
		<div class="divider divider-center mb-3">
				<div class="divider-text text-dark lh-base">@L("LoginWith")</div>
			</div>

		<!--end::Divider-->
		<div class="d-flex justify-content-center">
			<form asp-action="ExternalLogin" method="post">
				<input type="hidden" name="returnUrl" value="@ViewBag.ReturnUrl" />
				<input type="hidden" name="provider" value="" />
				<input type="hidden" name="ss" value="@ViewBag.SingleSignIn" />

				<!--begin::Options-->
				@* <div class="btn-showcase">
			<a class="btn btn-light" href="https://www.linkedin.com/login" target="_blank"><i class="txt-linkedin" data-feather="linkedin"></i> LinkedIn </a>
			<a class="btn btn-light" href="https://twitter.com/login?lang=en" target="_blank"><i class="txt-twitter" data-feather="twitter"></i>twitter</a>
			<a class="btn btn-light" href="https://www.facebook.com/" target="_blank"><i class="txt-fb" data-feather="facebook"></i>facebook</a>
			</div> *@
				@foreach (var p in loginProviders)
				{
					<a href="javascript:;" data-provider="@p.DisplayName" class="social-login-icon social-icon bg-facebook text-white rounded-circle">
						<i class="fa-brands fa-@getSocialIconClass(p.DisplayName)"></i>
						@p.DisplayName
					</a>

					@* <a class="btn btn-light social-login-icon" href="javascript:;" data-provider="@p.DisplayName"><i class="txt-@getSocialIconClass(p.DisplayName)" data-feather="@getSocialIconClass(p.DisplayName)"></i> @p.DisplayName </a> *@
				}
				<!--end::Options-->
			</form>
		</div>
	}
	@if (Model.IsSelfRegistrationEnabled)
	{
		<p class="mt-4 mb-0 text-center">Bạn chưa tham gia? <a class="ms-2" href="@Url.Action("Register", "Account", new {ss = ViewBag.SingleSignIn, returnUrl = ViewBag.ReturnUrl})" id="register-btn">@L("CreateAnAccount")</a></p>

	}
	@* @if (Model.IsTenantSelfRegistrationEnabled)
	{
		<p class="mt-4 mb-0 text-center">@L("RunBusiness?")<a class="ms-2" href="@Url.Action("SelectEdition", "TenantRegistration")" id="register-btn">@L("NewTenant")</a></p>
	} *@
	<p class="mt-4 mb-0 text-center">Đã có mã kích hoạt? <a class="ms-2" href="@Url.Action("EmailActivation", "Account")" id="email-activation-btn">@L("EmailActivation")</a></p>
</div>